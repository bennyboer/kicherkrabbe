<div class="header">
  <h2>Dateiverwaltung</h2>
  @if (uploadActive$ | async) {
    <app-button (click)="cancelUpload()">Abbrechen</app-button>
  } @else {
    <app-button
      (click)="activateUpload()"
      color="primary"
      [disabled]="uploadDisabled$ | async">
      <span class="icon-button">
        <span class="material-icons">upload</span>
        <span>Hochladen</span>
      </span>
    </app-button>
  }
</div>

@if (storageInfo$ | async; as storageInfoOption) {
  @if (storageInfoOption.unwrap(); as info) {
    <div class="storage-info" [class.warning]="info.limitBytes > 0 && getUsagePercent(info) > 90">
      @if (info.limitBytes > 0) {
        <span class="storage-text">Speicherplatz: {{ formatBytes(info.usedBytes) }} / {{ formatBytes(info.limitBytes) }}</span>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getUsagePercent(info)"></div>
        </div>
      } @else {
        <span class="storage-text">Speicherplatz: {{ formatBytes(info.usedBytes) }}</span>
      }
    </div>
  }
}

@if (uploadActive$ | async) {
  <div class="upload-area">
    <app-image-upload
      [multiple]="true"
      [watermark]="watermark$ | async"
      (uploaded)="onImagesUploaded($event)">
    </app-image-upload>
    <div class="upload-options">
      <app-checkbox
        label="Wasserzeichen hinzufÃ¼gen"
        [checked]="watermark$ | async"
        (checkedChanges)="onWatermarkChanged($event)">
      </app-checkbox>
    </div>
  </div>
}

<div class="browser-container">
  <app-asset-browser #browser mode="manage"></app-asset-browser>
</div>
