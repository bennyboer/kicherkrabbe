<p-toast />

<div class="fabric-detail-page">
	@if (loading$ | async) {
		<div class="loading-container">
			<p-progressspinner strokeWidth="4" />
		</div>
	} @else if (fabricData$ | async; as data) {
		<div class="back-nav">
			<p-button
				icon="pi pi-arrow-left"
				label="Zur端ck zu Stoffe"
				[text]="true"
				(click)="goBack()"
			/>
		</div>

		<div class="content-grid">
			<div class="image-section">
				<p-image
					[src]="getImageUrl(data.fabric.imageId)"
					[alt]="data.fabric.name"
					[preview]="true"
					width="100%"
					appendTo="body"
				/>
			</div>

			<div class="details-section">
				<h1 class="fabric-name">{{ data.fabric.name }}</h1>

				<div class="availability-section">
					<h2>Verf端gbarkeit</h2>
					@if (data.fabricTypeAvailabilities.length > 0) {
						<div class="availability-list">
							@for (ta of data.fabricTypeAvailabilities; track ta.type.id) {
								<div class="availability-item">
									<span class="type-name">{{ ta.type.name }}</span>
									@if (ta.inStock) {
										<p-tag severity="success" value="Verf端gbar" icon="pi pi-check" />
									} @else {
										<p-tag severity="warn" value="Auf Anfrage" icon="pi pi-clock" />
									}
								</div>
							}
						</div>
					} @else {
						<p-tag severity="warn" value="Auf Anfrage" icon="pi pi-clock" />
					}
				</div>

				@if (data.colors.length > 0) {
					<p-divider />

					<div class="colors-section">
						<h2>Farben</h2>
						<div class="colors-list">
							@for (color of data.colors; track color.id) {
								<div class="color-item">
									<app-color-swatch [color]="color" size="medium" />
									<span>{{ color.name }}</span>
								</div>
							}
						</div>
					</div>
				}

				@if (data.topics.length > 0) {
					<p-divider />

					<div class="topics-section">
						<h2>Themen</h2>
						<div class="topics-list">
							@for (topic of data.topics; track topic.id) {
								<p-tag [value]="topic.name" [rounded]="true" />
							}
						</div>
					</div>
				}

				<p-divider />

				<div class="contact-cta">
					<p>Interesse an diesem Stoff?</p>
					<a routerLink="/contact">
						<p-button label="Kontakt aufnehmen" icon="pi pi-envelope" />
					</a>
				</div>
			</div>
		</div>
	} @else {
		<div class="not-found">
			<p>Stoff nicht gefunden.</p>
			<p-button
				label="Zur端ck zu Stoffe"
				(click)="goBack()"
			/>
		</div>
	}
</div>
